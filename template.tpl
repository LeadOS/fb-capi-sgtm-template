___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Terrific Digital Facebook CAPI v2.0",
  "categories": [
    "ADVERTISING",
    "ANALYTICS",
    "ATTRIBUTION",
    "CONVERSIONS",
    "LEAD_GENERATION",
    "MARKETING",
    "REMARKETING"
  ],
  "brand": {
    "id": "brand_dummy",
    "displayName": "Terrific Digital",
    "thumbnail": "data:image/jpeg;base64,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\u003d\u003d"
  },
  "description": "Use this template to send server events to Facebook ads using their Conversions API.\nVisit us at: https://www.terrific-digital.com",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "pixel_id",
    "displayName": "Pixel ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "api_access_token",
    "displayName": "API Access Token",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "api_version",
    "displayName": "Graph API Version",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "valueHint": "v11.0",
    "defaultValue": "v11.0"
  },
  {
    "type": "TEXT",
    "name": "event_id",
    "displayName": "Event ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "If the same event is being sent from the user\u0027s browser, you must include the same unique event ID for both events, so Facebook could deduplicate them, if not, they might be count as two different events.",
    "alwaysInSummary": true
  },
  {
    "type": "TEXT",
    "name": "action_source",
    "displayName": "Action Source (optional)",
    "simpleValueType": true,
    "defaultValue": "website",
    "help": "Where the event originated from, the value must be one of the following:\n\u003cbr\u003e\u003cb\u003e‣ email\u003c/b\u003e\n\u003cbr\u003e\u003cb\u003e‣ website\u003c/b\u003e\n\u003cbr\u003e\u003cb\u003e‣ app\u003c/b\u003e\n\u003cbr\u003e\u003cb\u003e‣ phone_call\u003c/b\u003e\n\u003cbr\u003e\u003cb\u003e‣ chat\u003c/b\u003e\n\u003cbr\u003e\u003cb\u003e‣ physical_store\u003c/b\u003e\n\u003cbr\u003e\u003cb\u003e‣ system_generated\u003c/b\u003e\n\u003cbr\u003e\u003cb\u003e‣ other\u003c/b\u003e\n\u003cbr\u003e\u003cbr\u003e\nIf no value is specified, it will be defaulted to \"\u003ci\u003ewebsite\u003c/i\u003e\".",
    "alwaysInSummary": true,
    "valueHint": "website"
  },
  {
    "type": "TEXT",
    "name": "test_event_code",
    "displayName": "Test Event Code (optional)",
    "simpleValueType": true
  },
  {
    "type": "SELECT",
    "name": "fbp_cookie",
    "displayName": "_fbp Cookie",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true,
    "notSetText": "Choose the _fbp Cookie Source"
  },
  {
    "type": "SELECT",
    "name": "fbc_cookie",
    "displayName": "_fbc Cookie",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true,
    "notSetText": "Choose the _fbc Cookie Source"
  },
  {
    "type": "CHECKBOX",
    "name": "standard_events_mapping",
    "checkboxText": "Turn On Standard Events Mapping",
    "simpleValueType": true,
    "help": "By turning on this feature, Facebook\u0027s standard ecommerce events will be mapped automatically with their GA4 counterparts:\n\u003cbr\u003e\u003cb\u003e‣ page_view\u003c/b\u003e → \u003cb\u003ePageView\u003c/b\u003e\n\u003cbr\u003e\u003cb\u003e‣ add_payment_info\u003c/b\u003e → \u003cb\u003eAddPaymentInfo\u003c/b\u003e\n\u003cbr\u003e\u003cb\u003e‣ add_to_cart\u003c/b\u003e → \u003cb\u003eAddToCart\u003c/b\u003e\n\u003cbr\u003e\u003cb\u003e‣ add_to_wishlist\u003c/b\u003e → \u003cb\u003eAddToWishlist\u003c/b\u003e\n\u003cbr\u003e\u003cb\u003e‣ sign_up\u003c/b\u003e → \u003cb\u003eCompleteRegistration\u003c/b\u003e\n\u003cbr\u003e\u003cb\u003e‣ begin_checkout \u003c/b\u003e → \u003cb\u003eInitiateCheckout\u003c/b\u003e\n\u003cbr\u003e\u003cb\u003e‣ generate_lead\u003c/b\u003e → \u003cb\u003eLead\u003c/b\u003e\n\u003cbr\u003e\u003cb\u003e‣ purchase\u003c/b\u003e → \u003cb\u003ePurchase\u003c/b\u003e\n\u003cbr\u003e\u003cb\u003e‣ search\u003c/b\u003e → \u003cb\u003eSearch\u003c/b\u003e\n\u003cbr\u003e\u003cb\u003e‣ view_item\u003c/b\u003e → \u003cb\u003eViewContent\u003c/b\u003e\n\u003cbr\u003e\u003cbr\u003e\u003ca href\u003d\"https://developers.google.com/analytics/devguides/collection/ga4/reference/events?hl\u003den\u0026client_type\u003dgtag\" target\u003d\"_new\"\u003eClick here\u003c/a\u003e to see the full list of GA4 standard events. \u003cbr\u003e \u003ca href\u003d\"https://developers.facebook.com/docs/meta-pixel/reference/\" target\u003d\"_new\"\u003eClick here\u003c/a\u003e to see the full list of Facebook\u0027s standard events.",
    "displayName": "Standard Events"
  },
  {
    "type": "CHECKBOX",
    "name": "ecommerce",
    "checkboxText": "Turn On Ecommerce Events",
    "simpleValueType": true,
    "displayName": "Ecommerce Events",
    "help": "By turning on this feature, the following event parameters will be processed automatically:\n\u003cbr\u003e\u003cb\u003e‣ value\u003c/b\u003e - if \u0027value\u0027 is present in the GA4 event.\n\u003cbr\u003e\u003cb\u003e‣ currency\u003c/b\u003e - if \u0027currency\u0027 is present in the GA4 event.\n\u003cbr\u003e\u003cb\u003e‣ content_name\u003c/b\u003e - if \u0027items\u0027 object is present in the GA4 event, and there is only 1 item.\n\u003cbr\u003e\u003cb\u003e‣ content_category\u003c/b\u003e - if \u0027items\u0027 object is present in the GA4 event, and there is only 1 item.\n\u003cbr\u003e\u003cb\u003e‣ num_items\u003c/b\u003e - if \u0027items\u0027 object is present in the GA4 event (aggregates all items\u0027 quantities).\n\u003cbr\u003e\u003cb\u003e‣ content_ids\u003c/b\u003e - if \u0027items\u0027 object is present in the GA4 event.\n\u003cbr\u003e\u003cb\u003e‣ contents\u003c/b\u003e - if \u0027items\u0027 object is present in the GA4 event.\n\u003cbr\u003e\u003cbr\u003eIt\u0027s highly recommended to activate the \"\u003ci\u003eTurn On Standard Events Mapping\u003c/i\u003e\" checkbox as well.\n\u003cbr\u003e\u003cbr\u003e\u003ca href\u003d\"https://developers.google.com/analytics/devguides/collection/ga4/reference/events?hl\u003den\u0026client_type\u003dgtag\" target\u003d\"_new\"\u003eClick here\u003c/a\u003e to see the full list of GA4 standard events. \u003cbr\u003e \u003ca href\u003d\"https://developers.facebook.com/docs/meta-pixel/reference/\" target\u003d\"_new\"\u003eClick here\u003c/a\u003e to see the full list of Facebook\u0027s standard events.",
    "alwaysInSummary": true
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "events_mapping",
    "displayName": "Custom Events Mapping",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "GA4 Event Name",
        "name": "ga4_event_name",
        "type": "TEXT",
        "isUnique": true,
        "valueHint": "page_view",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "defaultValue": "",
        "displayName": "Facebook Event Name",
        "name": "fb_event_name",
        "type": "TEXT",
        "valueHint": "PageView",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      }
    ],
    "newRowButtonText": "Add Event",
    "help": "\u003cb\u003eDo NOT use this feature to map standard events!\u003c/b\u003e\n\u003cbr\u003eInstead, use the \"\u003ci\u003eTurn On Standard Events Mapping\u003c/i\u003e\" checkbox.\n\u003cbr\u003e\u003cbr\u003e\nMap sGTM events that are sent for Google Analytics 4 with their Facebook counterparts.\n\u003cbr\u003e\nFor example, if sGTM receives a \"login\" GA4 event, send it to Facebook as \"Log In\".\n\u003cbr\u003e\u003cbr\u003e\nIf the GA4 event is not mapped in this table, it will be sent to Facebook exactly as it is.\n\u003cbr\u003e\u003cbr\u003e\n\u003ca href\u003d\"https://developers.google.com/analytics/devguides/collection/ga4/reference/events?hl\u003den\u0026client_type\u003dgtag\" target\u003d\"_new\"\u003eClick here\u003c/a\u003e to see the full list of GA4 standard events.\n\u003cbr\u003e\n\u003ca href\u003d\"https://developers.facebook.com/docs/meta-pixel/reference/\" target\u003d\"_new\"\u003eClick here\u003c/a\u003e to see the full list of Facebook\u0027s standard events."
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "params_mapping",
    "displayName": "Event Parameters Mapping",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "GA4 Event Parameter Name",
        "name": "ga4_param_name",
        "type": "TEXT",
        "isUnique": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "valueHint": "search_term"
      },
      {
        "defaultValue": "",
        "displayName": "Facebook Event Parameter Name",
        "name": "fb_param_name",
        "type": "TEXT",
        "valueHint": "",
        "isUnique": false,
        "valueValidators": []
      },
      {
        "defaultValue": "str",
        "displayName": "Value Type",
        "name": "param_type",
        "type": "SELECT",
        "selectItems": [
          {
            "value": "str",
            "displayValue": "Text (string)"
          },
          {
            "value": "int",
            "displayValue": "Whole number (integer)"
          },
          {
            "value": "float",
            "displayValue": "Decimal number (float)"
          }
        ],
        "macrosInSelect": false,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      }
    ],
    "newRowButtonText": "Add Parameter",
    "help": "\u003cb\u003eDo NOT use this feature to map ecommerce event parameters!\u003c/b\u003e\n\u003cbr\u003eInstead, use the \"\u003ci\u003eTurn On Ecommerce Events\u003c/i\u003e\" checkbox.\n\u003cbr\u003e\u003cbr\u003e\nMap sGTM event parameters that are sent for Google Analytics 4 with their Facebook counterparts.\n\u003cbr\u003e \nFor example, if sGTM receives a \"search_term\" GA4 event parameter, send it to Facebook as \"search_string\".\n\u003cbr\u003e\u003cbr\u003e\nIf the GA4 event parameter is not mapped in this table, \u003cb\u003eit won\u0027t be sent to Facebook\u003c/b\u003e.\n\u003cbr\u003e\u003cbr\u003e\nIf you leave \"\u003ci\u003eFacebook Event Parameter Name\u003c/i\u003e\" empty, the original GA4 parameter name will be sent to Facebook exactly as it is.\n\u003cbr\u003e\u003cbr\u003e\n\u003ca href\u003d\"https://developers.google.com/analytics/devguides/collection/ga4/reference/events?hl\u003den\u0026client_type\u003dgtag\" target\u003d\"_new\"\u003eClick here\u003c/a\u003e to see the full list of GA4 standard events. \u003cbr\u003e \u003ca href\u003d\"https://developers.facebook.com/docs/meta-pixel/reference/\" target\u003d\"_new\"\u003eClick here\u003c/a\u003e to see the full list of Facebook\u0027s standard events."
  }
]


___SANDBOXED_JS_FOR_SERVER___

// Load the APIs
const getAllEventData = require('getAllEventData');
const getTimestampMillis = require('getTimestampMillis');
const JSON = require('JSON');
const log = require('logToConsole');
const Math = require('Math');
const sendHttpRequest = require('sendHttpRequest');
const eventModel = getAllEventData();
const Object = require('Object');
const makeString = require('makeString');
const makeInteger = require('makeInteger');
const makeNumber = require('makeNumber');

const API_ENDPOINT = 'https://graph.facebook.com';
const VERSION = data.api_version;

// Map GA4 event names to their Facebook counterparts
const events_dict = {};
if (!data.events_mapping) {
  data.events_mapping = [];
}
data.events_mapping.forEach(function (pair) {
  events_dict[pair.ga4_event_name] = pair.fb_event_name;
});

if (data.standard_events_mapping) {
  events_dict.add_payment_info = 'AddPaymentInfo';
  events_dict.add_to_cart = 'AddToCart';
  events_dict.add_to_wishlist = 'AddToWishlist';
  events_dict.page_view = 'PageView';
  events_dict.purchase = 'Purchase';
  events_dict.search = 'Search';
  events_dict.signup = 'CompleteRegistration';
  events_dict.view_item = 'ViewContent';
  events_dict.begin_checkout = 'InitiateCheckout';
  events_dict.generate_lead = 'Lead';
}

const event_name = events_dict[eventModel.event_name] || eventModel.event_name;

// Map GA4 event parameters names to their Facebook counterparts
const params_dict = {};
data.params_mapping.forEach(function (param) {
  params_dict[param.ga4_param_name] = param.fb_param_name || param.ga4_param_name;
  params_dict[param.ga4_param_name + '_type'] = param.param_type || 'str';
});
log(params_dict);

const event = {};

// Start building the Facebook data object (event.*) by mapping items in 
// the generic event data object (eventModel.*) into the expected format
event.event_name = event_name;
event.event_time = eventModel.event_time || (Math.round(getTimestampMillis() / 1000));
event.event_id = data.event_id;
event.event_source_url = eventModel.page_location;
event.action_source = data.action_source || 'website';

event.user_data = {};
event.user_data.client_ip_address = eventModel.ip_override;
event.user_data.client_user_agent = eventModel.user_agent;
//event.user_data.em = eventModel.user_data.email_address;


// Fetch _fbp and _fbc cookie values from corresponding tag fields
if (data.fbp_cookie) event.user_data.fbp = data.fbp_cookie;
if (data.fbc_cookie) event.user_data.fbc = data.fbc_cookie;

event.custom_data = {};

// Set custom parameters (and translate from GA4 parameters).
const params_list = Object.keys(params_dict);
params_list.forEach(function (param) {
  if(eventModel[param]) {
    if(params_dict[param + '_type'] === 'str') {
      event.custom_data[params_dict[param]] = makeString(eventModel[param]) || '';
    } else if (params_dict[param + '_type'] === 'int') {
      event.custom_data[params_dict[param]] = makeInteger(eventModel[param]) || 0;
    } else if (params_dict[param + '_type'] === 'float') {
      event.custom_data[params_dict[param]] = makeNumber(eventModel[param]) || 0.0;
    }
  }
});

if (data.ecommerce) {
  if (eventModel.value) event.custom_data.value = eventModel.value;
  if (eventModel.currency) event.custom_data.currency = eventModel.currency;
  if (eventModel.transaction_id) event.custom_data.transaction_id = eventModel.transaction_id;
  if (eventModel.coupon) event.custom_data.coupon = eventModel.coupon;
  if (eventModel.payment_type) event.custom_data.payment_type = eventModel.payment_type;
  if (eventModel.items) {
    if (eventModel.items.length === 1) {
      event.custom_data.content_name = eventModel.items[0].item_name;
      event.custom_data.content_ids = [eventModel.items[0].item_id];
      event.custom_data.content_type = 'product';
      event.custom_data.content_category = eventModel.items[0].item_category || '';
      event.custom_data.num_items = eventModel.items[0].quantity || 1;
      event.custom_data.contents = [{id: eventModel.items[0].item_id, quantity: eventModel.items[0].quantity || 1}];
    } else {
      var content_ids = [];
      var contents = [];
      var num_items = 0;
      eventModel.items.forEach(function (item) {
        content_ids.push(item.item_id);
        contents.push({id: item.item_id, quantity: item.quantity || 1});
        num_items = num_items + item.quantity || 1;
      });
      event.custom_data.content_type = 'product';
      event.custom_data.content_ids = content_ids;
      event.custom_data.contents = contents;
      event.custom_data.num_items = num_items;
    }
  }
}

const eventRequest = {data: [event]};

if(data.test_event_code) {
  eventRequest.test_event_code = data.test_event_code;
}

const routeParams = 'events?access_token=' + data.api_access_token;
const graphEndpoint = [API_ENDPOINT,
                       VERSION,
                       data.pixel_id,
                       routeParams].join('/');

log('Sending eventRequest', eventRequest);

const requestHeaders = {headers: {'content-type': 'application/json'}, method: 'POST'};
sendHttpRequest(
  graphEndpoint,
  (statusCode, headers, response) => {
    log(JSON.stringify(response));
    if (statusCode >= 200 && statusCode < 300) {
      data.gtmOnSuccess();
      return;
    }
    data.gtmOnFailure();
  },
  requestHeaders,
  JSON.stringify(eventRequest));


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://graph.facebook.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []
setup: ''


___NOTES___

Created on 8/5/2020, 10:20:28 AM


